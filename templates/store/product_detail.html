{% extends 'store/base_store.html' %}

{% load static %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
    <section class="product-detail-page">
        <div class="section-container">
            <div class="image-text split-layout">
                <div class="image-column">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}">
                </div>
                <div class="info-column">
                    <h2>{{ product.name }}</h2>
                    <p>{{ product.description }}</p>
                </div>
            </div>
            <!-- Add-to-cart form moved here, centered -->
            <div class="add-to-cart-form-container" style="display: flex; justify-content: center; margin-top: 2.5rem;">
                <form action="{% url 'store:add_to_cart' product.pk %}" method="post" class="add-to-cart-form">
                    {% csrf_token %}
                    <div class="packaging-options">
                        <label for="packaging_option">–†–∞–∑—Ñ–∞—Å–æ–≤–∫–∞:</label>
                        <select name="packaging_option" id="packaging_option" required>
                            {% for option in packaging_options %}
                                <option value="{{ option.id }}" {% if option == default_option %}selected{% endif %}>
                                    {{ option.weight|floatformat:2 }} –∫–≥ -
                                    {% if product.is_on_sale and option.sale_price %}
                                        {{ option.sale_price }} –ª–≤.
                                    {% else %}
                                        {{ option.price }} –ª–≤.
                                    {% endif %}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="quantity-selector">
                        <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                        <div class="quantity-controls">
                            <button type="button" class="qty-btn" onclick="updateQuantity(-1)">-</button>
                            <input type="number" name="quantity" id="quantity" value="1" min="1" required>
                            <button type="button" class="qty-btn" onclick="updateQuantity(1)">+</button>
                        </div>
                    </div>
                    <button type="submit" class="btn-cart">
                        –î–æ–±–∞–≤–∏ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞
                    </button>
                </form>
            </div>
        </div>
    </section>
    <section class="product-detail-extra section-container">
        <div class="product-detail-flex">
            <div class="accordion">
                <div class="accordion-item">
                    <h3 class="accordion-header">üßÄ –°—ä—Å—Ç–∞–≤</h3>
                    <p class="accordion-content">{{ product.ingredients }}</p>
                </div>
                <div class="accordion-item">
                    <h3 class="accordion-header">üì¶ –°—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ</h3>
                    <p class="accordion-content">{{ product.storage }}</p>
                </div>
                <div class="accordion-item">
                    <h3 class="accordion-header">‚ùì –•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞</h3>
                    {% if product.nutrition %}
                        <div class="accordion-content">
                            <ul class="nutrition-list" style="list-style: none; padding: 0; margin: 0;">
                                <li><strong>–•—Ä–∞–Ω–∏—Ç–µ–ª–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –∑–∞ 100g:</strong></li>
                                <li>–ï–Ω–µ—Ä–≥–∏–π–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç: {{ product.nutrition.energy }}</li>
                                <li>–ú–∞–∑–Ω–∏–Ω–∏: {{ product.nutrition.fat }}g</li>
                                <li>–û—Ç –∫–æ–∏—Ç–æ –Ω–∞—Å–∏—Ç–µ–Ω–∏ –º–∞—Å—Ç–Ω–∏ –∫–∏—Å–µ–ª–∏–Ω–∏: {{ product.nutrition.saturated_fat }}g</li>
                                <li>–í—ä–≥–ª–µ—Ö–∏–¥—Ä–∞—Ç–∏: {{ product.nutrition.carbohydrates }}g</li>
                                <li>–û—Ç –∫–æ–∏—Ç–æ –∑–∞—Ö–∞—Ä–∏: {{ product.nutrition.sugars }}g</li>
                                <li>–ë–µ–ª—Ç—ä—Ü–∏: {{ product.nutrition.protein }}g</li>
                                <li>–°–æ–ª: {{ product.nutrition.salt }}g</li>
                            </ul>
                        </div>
                    {% else %}
                        <p class="accordion-content">–ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.</p>
                    {% endif %}
                </div>
            </div>
            <div class="product-actions">
                <!-- Remove product-inquiry-form-section -->
            </div>
        </div>
    </section>
    <section class="other-products section-container">
        <h2>–î—Ä—É–≥–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</h2>
        <div class="product-grid">
            {% for other in related_products %}
                {% if other.id != product.id %}
                    <a href="{% url 'store:product_detail' other.pk %}">
                        <div class="product-card">
                            <img src="{{ other.image.url }}" alt="{{ other.name }}">
                            {% if other.badge %}
                                <img src="{{ other.badge.url }}" alt="badge" class="badge-img">
                            {% endif %}
                            <div class="card-body">
                                <h3 class="card-title">{{ other.name }}</h3>
                                <p class="card-subtitle">{{ other.badge_text }}</p>
                            </div>
                        </div>
                    </a>
                {% endif %}
                {% empty %}
                <p>–ù—è–º–∞ –¥—Ä—É–≥–∏ –ø—Ä–æ–¥—É–∫—Ç–∏.</p>
            {% endfor %}
        </div>
    </section>
    <script>
        document.querySelectorAll('.accordion-item').forEach(item => {
            const header = item.querySelector('.accordion-header');
            header.addEventListener('click', () => item.classList.toggle('open'));
        });
        function updateQuantity(change) {
            const input = document.getElementById('quantity');
            const newValue = Math.max(1, parseInt(input.value) + change);
            input.value = newValue;
        }
        document.getElementById('packaging_option').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const priceDisplay = document.querySelector('.price-display');
            if (priceDisplay) {
                priceDisplay.innerHTML = selectedOption.innerHTML;
            }
        });
    </script>
{% endblock %}
