{% extends 'store/base_store.html' %}

{% block title %}Обобщение на поръчката | Сакарела{% endblock %}

{% block content %}
    <style>
        @media print {
            /* Make the whole page free-flowing for print */
            html, body {
                height: auto !important;
                overflow: visible !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            /* Remove any viewport-based layout that might crop */
            .order-summary-container,
            .order-summary-box,
            .order-summary-content {
                height: auto !important;
                max-height: none !important;
                overflow: visible !important;
            }

            /* Optional: remove card look & extra padding to fit better */
            .order-summary-box {
                box-shadow: none !important;
                border-radius: 0 !important;
                margin: 0 !important;
            }

            /* Hide stuff you don’t want on the print */
            .btn-return-to-store,
            .yellow-bar,
            .recipe-hero,
            .breadcrumb-container,
            .site-header,
            .site-footer {
                display: none !important;
            }

            @page {
                size: A4 portrait;
                margin: 10mm;
            }
        }
    </style>

    <div class="recipe-hero">
        <div class="recipe-hero-content">
            <h1 class="recipe-hero-title">Количка</h1>
        </div>
    </div>

    <!-- Breadcrumbs -->
    <div class="breadcrumb-container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb" style="background-color: #E6EBE8 !important;">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Начало</a></li>
                <li class="breadcrumb-item"><a href="{% url 'store:store_home' %}">Онлайн магазин</a></li>
                <li class="breadcrumb-item"><a href="{% url 'store:cart' %}">Количка</a></li>
                <li class="breadcrumb-item"><a href="{% url 'store:order_info' %}">Информация за поръчка</a></li>
                <li class="breadcrumb-item active" aria-current="page">Обобщение на поръчката</li>
            </ol>
        </nav>
    </div>

    <div class="order-summary-container">
        <div class="order-summary-box">
            <h1 class="order-summary-title">ОБОБЩЕНИЕ НА ПОРЪЧКАТА</h1>

            <div class="order-summary-content">
                <section class="customer-details-section">
                    <h2 class="section-title">ДАННИ ЗА КЛИЕНТА</h2>
                    <div class="customer-details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Име:</span>
                            <span class="detail-value">{{ order.full_name }} {{ order.last_name }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Телефон:</span>
                            <span class="detail-value">{{ order.phone }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Имейл:</span>
                            <span class="detail-value">{{ order.email }}</span>
                        </div>
                        <div class="detail-item full-width">
                            <span class="detail-label">Адрес:</span>
                            <span class="detail-value">{{ order.country }}, {{ order.state }}, {{ order.city }}</span>
                        </div>
                        <div class="detail-item full-width">
                            <span class="detail-label">Улица:</span>
                            <span class="detail-value">
                                {{ order.address1 }}{% if order.address2 %}, {{ order.address2 }}{% endif %}
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Пощенски код:</span>
                            <span class="detail-value">{{ order.post_code }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Метод на плащане:</span>
                            <span class="detail-value">{{ order.get_payment_method_display }}</span>
                        </div>
                    </div>
                </section>

                <section class="order-products-section">
                    <h2 class="section-title">ПРОДУКТИ</h2>
                    <div class="products-table-container">
                        <table class="products-table">
                            <thead>
                            <tr>
                                <th>Продукт</th>
                                <th>Тегло</th>
                                <th>Количество</th>
                                <th>Цена</th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for item in cart_items %}
                                <tr>
                                    <td class="product-name">{{ item.product.name }}</td>
                                    <td class="product-weight">{{ item.unit_weight_g|floatformat:2 }} кг</td>
                                    <td class="product-quantity">{{ item.quantity }}</td>
                                    <td class="product-price">{{ item.price|floatformat:2 }} лв.</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                            <tfoot>
                            <tr class="total-row">
                                <td colspan="2" class="total-label">Общо продукти:</td>
                                <td class="total-amount">
                                    {{ order.total|floatformat:2 }} лв.
                                </td>
                            </tr>
                            <tr class="total-row shipping-row">
                                <td colspan="2" class="total-label">Доставка (Еконт):</td>
                                <td class="total-amount">
                                    {{ shipping|default_if_none:"0.00"|floatformat:2 }} лв.
                                </td>
                            </tr>
                            <tr class="total-row grand-total-row">
                                <td colspan="2" class="total-label"><strong>Крайна сума:</strong></td>
                                <td class="total-amount">
                                    <strong>{{ grand_total|floatformat:2 }} лв.</strong>
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </section>

                <div class="summary-actions" style="justify-content: space-evenly">
                    <a href="{% url 'store:store_home' %}" class="btn-return-to-store">
                        <i class="fas fa-arrow-left"></i>
                        Към магазин
                    </a>

                    <button type="button" class="btn-return-to-store"
                            onclick="printReceipt()">
                        <i class="fas fa-print"></i>
                        Принтирай поръчката
                    </button>
                </div>
            </div>
        </div>
    </div>

    <section class="yellow-bar">
        <p class="yellow-bar-text">ПРОДУКТИ С ГАРАНТИРАНО КАЧЕСТВО И ПРОИЗХОД</p>
    </section>

    <!-- Put script INSIDE content so it always renders -->
    <script>
        function printReceipt() {
            window.print();
        }

        {% if auto_print %}
            window.addEventListener('load', function () {
                printReceipt();
            });
        {% endif %}
    </script>
{% endblock %}
