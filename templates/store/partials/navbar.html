<nav class="site-nav">
    <div class="nav-container">
        <!-- Hamburger for mobile -->
        <button class="hamburger" id="mobile-menu-toggle" aria-label="–û—Ç–≤–æ—Ä–∏ –º–µ–Ω—é" aria-controls="mobile-menu" aria-expanded="false">
            <span class="hamburger-bar"></span>
            <span class="hamburger-bar"></span>
            <span class="hamburger-bar"></span>
        </button>
        <div class="nav-logo" style="margin-left: 0.35rem; margin-bottom: 0.1rem">
            <a href="{% url 'home' %}">
                <img src="/media/uploads/logos/sakarela_logo.png" alt="–°–∞–∫–∞—Ä–µ–ª–∞">
            </a>
        </div>
        <ul class="nav-left" style="margin-top: 0.75rem; margin-left: 0.27rem">
            <li><a href="{% url 'about' %}">–ó–∞ –ù–∞—Å</a></li>
            <li><a href="{% url 'store:where_to_buy' %}">–ú–∞–≥–∞–∑–∏–Ω–∏</a></li>
            <li><a href="{% url 'recipe_list' %}">–†–µ—Ü–µ–ø—Ç–∏</a></li>
            <li><a href="{% url 'products' %}">–ü—Ä–æ–¥—É–∫—Ç–∏</a></li>
            <li><a href="{% url 'contact' %}">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
        </ul>
        <ul class="nav-right" style="margin-top: 0.75rem; margin-left: 0.4rem">
            <li>
                <a href="{% url 'store:store_home' %}" class="buy-online">
                    –û–Ω–ª–∞–π–Ω –º–∞–≥–∞–∑–∏–Ω
                </a>
            </li>
        </ul>
        {% if request.resolver_match.url_name != 'order_info' %}
        <div class="cart-icon-wrapper">
            <a href="{% url 'store:cart' %}" class="cart-icon" aria-label="–ö–æ–ª–∏—á–∫–∞">
                <i class="fas fa-shopping-cart"></i> <span class="cart-count">{{ request.session.cart|length|default:0 }}</span>
            </a>
            <div class="cart-dropdown" id="cart-dropdown">
                {% if cart_items %}
                    {% for item in cart_items %}
                        <div class="cart-item">
                            <span>{{ item.product.name }} ({{ item.packaging.weight|floatformat:2 }} –∫–≥)</span>
                            <a href="{% url 'store:update_cart_quantity' item.product.id 'decrement' %}?packaging_id={{ item.packaging.id }}">-</a>
                            <span>x{{ item.quantity }}</span>
                            <a href="{% url 'store:update_cart_quantity' item.product.id 'increment' %}?packaging_id={{ item.packaging.id }}">+</a>
                            <a href="{% url 'store:remove_from_cart' item.product.id %}?packaging_id={{ item.packaging.id }}">üóë</a>
                        </div>
                    {% endfor %}
                    <div class="cart-total">
                        <strong>–û–±—â–æ: {{ cart_total|floatformat:2 }} –ª–≤.</strong>
                    </div>
                {% else %}
                    <p>–ö–æ–ª–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞</p>
                {% endif %}
                <a href="{% url 'store:cart' %}" class="btn-cart-dropdown-white">–ü—Ä–µ–≥–ª–µ–¥–∞–π –∫–æ–ª–∏—á–∫–∞—Ç–∞</a>
            </div>
        </div>
        {% endif %}
    </div>
    <!-- Slide-in mobile menu -->
    <div id="mobile-menu" class="mobile-slide-menu" aria-hidden="true">
        <button class="close-mobile-menu" id="close-mobile-menu" aria-label="–ó–∞—Ç–≤–æ—Ä–∏ –º–µ–Ω—é">&times;</button>
        <ul>
            <li><a href="{% url 'home' %}">–ù–∞—á–∞–ª–æ</a></li>
            <li><a href="{% url 'about' %}">–ó–∞ –ù–∞—Å</a></li>
            <li><a href="{% url 'store:where_to_buy' %}">–ú–∞–≥–∞–∑–∏–Ω–∏</a></li>
            <li><a href="{% url 'recipe_list' %}">–†–µ—Ü–µ–ø—Ç–∏</a></li>
            <li><a href="{% url 'products' %}">–ü—Ä–æ–¥—É–∫—Ç–∏</a></li>
            <li><a href="{% url 'contact' %}">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
            <li><a href="{% url 'store:store_home' %}">–û–Ω–ª–∞–π–Ω –º–∞–≥–∞–∑–∏–Ω</a></li>
        </ul>
    </div>
    <div id="mobile-menu-backdrop" class="mobile-menu-backdrop"></div>
</nav>

<script>
    // Hamburger menu toggle (mobile/tablet)
    const menuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const closeMenu = document.getElementById('close-mobile-menu');
    const backdrop = document.getElementById('mobile-menu-backdrop');

    function openMenu() {
        mobileMenu.classList.add('open');
        backdrop.classList.add('show');
        menuToggle.setAttribute('aria-expanded', 'true');
        mobileMenu.setAttribute('aria-hidden', 'false');
    }

    function closeMenuFn() {
        mobileMenu.classList.remove('open');
        backdrop.classList.remove('show');
        menuToggle.setAttribute('aria-expanded', 'false');
        mobileMenu.setAttribute('aria-hidden', 'true');
    }

    if (menuToggle) menuToggle.addEventListener('click', openMenu);
    if (closeMenu) closeMenu.addEventListener('click', closeMenuFn);
    if (backdrop) backdrop.addEventListener('click', closeMenuFn);

    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeMenuFn();
    });

    // --- SWIPE GESTURE FOR HAMBURGER MENU (mobile/tablet only) ---
    let touchStartX = 0;
    let touchEndX = 0;

    function handleTouchStart(e) {
        if (e.touches && e.touches.length === 1) {
            touchStartX = e.touches[0].clientX;
        }
    }

    function handleTouchMove(e) {
        if (e.touches && e.touches.length === 1) {
            touchEndX = e.touches[0].clientX;
        }
    }

    function handleTouchEnd() {
        const minSwipeDistance = 60; // px
        if (touchEndX - touchStartX > minSwipeDistance && window.innerWidth <= 1024) {
            openMenu();
        }
        touchStartX = 0;
        touchEndX = 0;
    }

    document.addEventListener('touchstart', handleTouchStart, {passive:true});
    document.addEventListener('touchmove', handleTouchMove, {passive:true});
    document.addEventListener('touchend', handleTouchEnd, {passive:true});

    // Cart dropdown functionality
    const cartWrapper = document.querySelector('.cart-icon-wrapper');
    const cartDropdown = document.querySelector('.cart-dropdown');

    if (cartWrapper && cartDropdown) {
        cartWrapper.addEventListener('mouseenter', function() {
            cartDropdown.style.display = 'block';
        });

        cartWrapper.addEventListener('mouseleave', function() {
            cartDropdown.style.display = 'none';
        });
    }
</script>
